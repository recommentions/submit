<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit</title>
    <script src="https://cdn.jsdelivr.net/npm/@octokit/core@6.1.2/dist-src/version.min.js"></script>
</head>
<body>
    <h1>Submit source</h1>
    <button id="loginButton">Login with GitHub</button>
    <div id="formContainer" style="display: none;">
        <form id="commitForm">
            <input type="text" id="filename" placeholder="File Name" required><br>
            <textarea id="content" placeholder="File Content" required></textarea><br>
            <button type="submit">Commit</button>
        </form>
    </div>
    <script>
        const clientId = 'Ov23liAkNANM7XzLgLHn';
        const loginButton = document.getElementById('loginButton');
        const formContainer = document.getElementById('formContainer');
        const commitForm = document.getElementById('commitForm');

        let accessToken = '';

        // Step 1: Login with GitHub
        loginButton.onclick = function() {
            const authUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&scope=repo&response_type=token`;
            window.location.href = authUrl;
        };

        // Step 2: Handle the OAuth Callback
        window.onload = async function() {
            const urlParams = new URLSearchParams(window.location.search);
            code = urlParams.get('code');
            console.log(code)
            if (code) {
                // Exchange code for access token
            const tokenResponse = await fetch('https://github.com/login/oauth/access_token', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    client_id: clientId,
                    code: code,
                    // Note: We're not including client_secret here
                })
            });

            const tokenData = await tokenResponse.json();
            accessToken = tokenData.access_token;
                loginButton.style.display = 'none';
                formContainer.style.display = 'block';
                const octokit = new Octokit({ auth: accessToken });
                const userInfo = await getUserInfo(octokit);
                if (userInfo) {
                    username = userInfo.login;
                    console.log('Authenticated as:', username);
                }
            }
        };

        // Step 3: Handle Form Submission
        commitForm.onsubmit = async function(event) {
            event.preventDefault();
            const repo = 'recommentions';
            const filename = document.getElementById('filename').value;
            const content = document.getElementById('content').value;

            
        };
    </script>
</body>
</html>
