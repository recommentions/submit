<html lang="en">
<meta charset="utf-8"> 
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@octokit/rest@21.0.2/dist-src/index.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Submit source</title>
<div id="root"></div>
<script type="module">
    import { Octokit, App } from "https://esm.sh/octokit";
    window.Octokit = Octokit;
</script>
<script type="text/babel">
    (async () => {
        const { useState, useEffect } = React;
        const root = ReactDOM.createRoot( document.getElementById('root') );
        root.render( <Profiles /> );

        function Profiles() {
            const [octokit, setOctokit] = useState();
            const [username, setUsername] = useState();

            useEffect(() => {
                if (octokit) {
                    octokit.rest.users.getAuthenticated().then( ( { data } ) => {
                        setUsername(data.login)
                    } );
                }
            },[octokit]);

            return (
                <form onSubmit={(event) => {
                    event.preventDefault();
                    if ( event.target.password.value ) {
                        setOctokit( new Octokit({ auth: event.target.password.value }))
                    }
                }}>
                    { !octokit && <>
                        <input name="username" type="hidden" value="recommentions" autoComplete="username" />
                        <input name="password" type="password" autoComplete="current-password" />
                        </> }
                    {username&& <>Logged in as {username}.</>}
                    <button>Submit</button>
                </form>
            );
        }
    })()
</script>
<!-- <script type="module">
    import { Octokit, App } from "https://esm.sh/octokit";
    const loginButton = document.getElementById('loginButton');
    const formContainer = document.getElementById('formContainer');
    const commitForm = document.getElementById('commitForm');

    async function getUserInfo(octokit) {
        try {
            const { data } = await octokit.rest.users.getAuthenticated();
            return data;
        } catch (error) {
            console.error('Error fetching user info:', error);
            return null;
        }
    }

    // Step 3: Handle Form Submission
    commitForm.onsubmit = async function(event) {
        event.preventDefault();
        console.log(document.getElementById('token').value)
        const octokit = new Octokit({ auth: document.getElementById('token').value });
            const userInfo = await getUserInfo(octokit);
            const username = userInfo.login;
                console.log('Authenticated as:', username);
        await octokit.rest.repos.createOrUpdateFileContents({
            owner: 'recommentions',
            repo: 'source',
            path: 'books/test.json',
            message: 'adding test',
            content: btoa(JSON.stringify({
                title: "test"
            })),
        });
    };
</script> -->
